name: semantic_release_check

# define when this workflow is triggered
on:
  workflow_dispatch:
  pull_request:

# cancel pending or running jobs of only this workflow
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # dry run of semantic release without changing anything
  release:
    name: Semantic Release
    runs-on: ubuntu-latest
    steps:
      # checkout the repo and supply a PAT for the changelog update commit.
      - id: checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref }}

      # use semantic-release in no operation mode
      - name: Semantic Release dry run
        id: semantic
        uses: python-semantic-release/python-semantic-release@master
        with:
          root_options: --noop

      - name: Use the version
        run: echo "The version is ${{ steps.semantic.outputs.version }}"

      - name: New release?
        run:
          echo "Will a new version be release? ${{
          steps.semantic.outputs.released }}"

      # - name: Semantic Release dry run
      #   id: semantic
      #   run: |
      #     OUTPUT=$(unset GITHUB_ACTIONS && npx semantic-release --dry-run --no-ci --branches "${{ github.head_ref }}")
      #     VERSION=$(echo "$OUTPUT" | grep -o "The next release version is [0-9]*\.[0-9]*\.[0-9]*" | awk '{print $6}')
      #     echo "::set-output name=version::$VERSION"
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
